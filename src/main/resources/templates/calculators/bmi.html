<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(~{::content})}">

<div th:fragment="content">
    <!-- Page Header -->
    <header class="text-center mb-8 pb-6 border-b border-gray-200">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">BMI Calculator</h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Calculate your Body Mass Index (BMI) and understand your weight status with our easy-to-use calculator.
        </p>
    </header>

    <!-- Calculator Container -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Form Section -->
        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
            <form id="bmi-form" class="space-y-6">
                <!-- Unit System -->
                <div>
                    <label for="unit" class="block text-sm font-semibold text-gray-700 mb-2">Unit System</label>
                    <select id="unit" name="unit"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        <option value="metric">Metric (kg, cm)</option>
                        <option value="imperial">Imperial (lbs, inches)</option>
                    </select>
                </div>

                <!-- Weight and Height -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="weight" class="block text-sm font-semibold text-gray-700 mb-2">Weight</label>
                        <div class="relative">
                            <input type="number" id="weight" name="weight"
                                   class="w-full pl-4 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                   value="70" min="1" max="1000" step="0.1" required>
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm font-medium" id="weight-unit">kg</span>
                        </div>
                    </div>

                    <div>
                        <label for="height" class="block text-sm font-semibold text-gray-700 mb-2">Height</label>
                        <div class="relative">
                            <input type="number" id="height" name="height"
                                   class="w-full pl-4 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                   value="175" min="1" max="300" step="0.1" required>
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm font-medium" id="height-unit">cm</span>
                        </div>
                    </div>
                </div>

                <!-- Calculate Button -->
                <button type="submit"
                        class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-lg hover:shadow-xl">
                    Calculate BMI
                </button>
            </form>
        </div>

        <!-- Results Section -->
        <div id="bmi-results" class="space-y-6">
            <!-- BMI Result Display -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-xl p-8 text-center">
                <div class="text-5xl font-bold text-blue-600 mb-3" id="bmi-result">22.9</div>
                <div class="text-xl font-semibold text-gray-900 mb-3" id="bmi-category">Normal weight</div>
                <div class="text-sm text-gray-600 max-w-sm mx-auto leading-relaxed" id="bmi-advice">
                    Maintain your healthy lifestyle with balanced diet and regular exercise.
                </div>
            </div>

            <!-- BMI Categories -->
            <div class="bg-white border border-gray-200 rounded-xl p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">BMI Categories</h4>
                <div class="space-y-3" id="category-list">
                    <div class="flex justify-between items-center p-3 bg-blue-50 border border-blue-200 rounded-lg font-semibold">
                        <span class="text-blue-900">Underweight</span>
                        <span class="text-blue-700">Below 18.5</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-green-50 border-2 border-green-300 rounded-lg font-semibold">
                        <span class="text-green-900">Normal weight</span>
                        <span class="text-green-700">18.5 - 25</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <span class="text-yellow-900">Overweight</span>
                        <span class="text-yellow-700">25 - 30</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-red-50 border border-red-200 rounded-lg">
                        <span class="text-red-900">Obese</span>
                        <span class="text-red-700">30+</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // BMI Calculator JavaScript with Tailwind
    class BMICalculator {
        constructor() {
            this.form = document.querySelector('#bmi-form');
            this.categories = [
                { min: 0, max: 18.5, name: 'Underweight', color: 'blue', bgClass: 'bg-blue-50 border-blue-300', textClass: 'text-blue-600' },
                { min: 18.5, max: 25, name: 'Normal weight', color: 'green', bgClass: 'bg-green-50 border-green-300', textClass: 'text-green-600' },
                { min: 25, max: 30, name: 'Overweight', color: 'yellow', bgClass: 'bg-yellow-50 border-yellow-300', textClass: 'text-yellow-600' },
                { min: 30, max: Infinity, name: 'Obese', color: 'red', bgClass: 'bg-red-50 border-red-300', textClass: 'text-red-600' }
            ];
            this.init();
        }

        init() {
            if (this.form) {
                // Update units when system changes
                this.form.querySelector('#unit').addEventListener('change', (e) => {
                    this.updateUnits(e.target.value);
                });

                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.calculate();
                });

                // Real-time calculation
                this.form.addEventListener('input', () => {
                    this.calculate();
                });

                // Initial calculation
                this.calculate();
            }
        }

        updateUnits(unit) {
            const weightUnit = this.form.querySelector('#weight-unit');
            const heightUnit = this.form.querySelector('#height-unit');
            const weightInput = this.form.querySelector('#weight');
            const heightInput = this.form.querySelector('#height');

            if (unit === 'metric') {
                weightUnit.textContent = 'kg';
                heightUnit.textContent = 'cm';
                weightInput.value = '70';
                heightInput.value = '175';
            } else {
                weightUnit.textContent = 'lbs';
                heightUnit.textContent = 'in';
                weightInput.value = '154';
                heightInput.value = '69';
            }
            this.calculate();
        }

        calculate() {
            try {
                const inputs = this.getInputValues();
                const results = this.calculateBMI(inputs);
                this.updateResults(results);
                this.updateCategories(results.bmi);
            } catch (error) {
                console.error('BMI calculation error:', error);
            }
        }

        getInputValues() {
            return {
                weight: parseFloat(this.form.querySelector('#weight').value) || 0,
                height: parseFloat(this.form.querySelector('#height').value) || 0,
                unit: this.form.querySelector('#unit').value || 'metric'
            };
        }

        calculateBMI(inputs) {
            if (inputs.weight <= 0 || inputs.height <= 0) {
                throw new Error('Invalid weight or height');
            }

            let bmi;
            if (inputs.unit === 'metric') {
                // kg and cm
                const heightM = inputs.height / 100;
                bmi = inputs.weight / (heightM * heightM);
            } else {
                // lbs and inches
                bmi = (inputs.weight / (inputs.height * inputs.height)) * 703;
            }

            const category = this.getBMICategory(bmi);
            const advice = this.getBMIAdvice(category);

            return {
                bmi: bmi,
                category: category,
                advice: advice
            };
        }

        getBMICategory(bmi) {
            return this.categories.find(cat => bmi >= cat.min && bmi < cat.max) || this.categories[0];
        }

        getBMIAdvice(category) {
            const advice = {
                'Underweight': 'Consider consulting with a healthcare provider about healthy weight gain strategies.',
                'Normal weight': 'Maintain your healthy lifestyle with balanced diet and regular exercise.',
                'Overweight': 'Consider lifestyle changes like increased physical activity and balanced nutrition.',
                'Obese': 'Consult with a healthcare provider for personalized weight management advice.'
            };

            return advice[category.name] || 'Consult with a healthcare provider for personalized advice.';
        }

        updateResults(results) {
            const resultElement = document.querySelector('#bmi-result');
            const categoryElement = document.querySelector('#bmi-category');
            const adviceElement = document.querySelector('#bmi-advice');
            const resultContainer = resultElement.closest('div');

            resultElement.textContent = results.bmi.toFixed(1);
            categoryElement.textContent = results.category.name;
            adviceElement.textContent = results.advice;

            // Update result container styling
            resultContainer.className = `bg-gradient-to-br from-${results.category.color}-50 to-${results.category.color}-100 border-2 border-${results.category.color}-300 rounded-xl p-8 text-center`;
            resultElement.className = `text-5xl font-bold ${results.category.textClass} mb-3`;
        }

        updateCategories(currentBMI) {
            const categoryList = document.querySelector('#category-list');
            if (!categoryList) return;

            categoryList.innerHTML = '';

            this.categories.forEach(category => {
                const isActive = currentBMI >= category.min && currentBMI < category.max;
                const item = document.createElement('div');

                const rangeText = category.max === Infinity ?
                    `${category.min}+` :
                    `${category.min} - ${category.max}`;

                if (isActive) {
                    item.className = `flex justify-between items-center p-3 ${category.bgClass} border-2 rounded-lg font-semibold`;
                } else {
                    item.className = `flex justify-between items-center p-3 bg-gray-50 border border-gray-200 rounded-lg`;
                }

                item.innerHTML = `
                <span class="${isActive ? category.textClass.replace('600', '900') : 'text-gray-700'}">${category.name}</span>
                <span class="${isActive ? category.textClass.replace('600', '700') : 'text-gray-500'}">${rangeText}</span>
            `;

                categoryList.appendChild(item);
            });
        }
    }

    // Initialize BMI calculator when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        new BMICalculator();
    });
</script>

</html>